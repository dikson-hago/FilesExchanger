(function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A;b=a.FilesExchanger=a.FilesExchanger||{};c=b.Host=b.Host||{};d=c.JsModules=c.JsModules||{};e=d.Store=d.Store||{};f=e.IpAddressStore=e.IpAddressStore||{};g=a.StartupCode$FilesExchanger_Host$IpAddressStore=a.StartupCode$FilesExchanger_Host$IpAddressStore||{};h=d.SendFileJsModule=d.SendFileJsModule||{};i=d.GetFileJsModule=d.GetFileJsModule||{};j=d.TestConnectionJsModule=d.TestConnectionJsModule||{};k=d.DeviceNameJsModule=d.DeviceNameJsModule||{};l=c.Client=c.Client||{};m=a.FilesExchanger$Host_Templates=a.FilesExchanger$Host_Templates||{};n=a.WebSharper;o=n&&n.Concurrency;p=n&&n.Remoting;q=p&&p.AjaxRemotingProvider;r=n&&n.UI;s=r&&r.Var$1;t=r&&r.Templating;u=t&&t.Runtime;v=u&&u.Server;w=v&&v.ProviderBuilder;x=v&&v.Handler;y=v&&v.TemplateInstance;z=r&&r.Client;A=z&&z.Templates;f.externalIpAddress=function(){g.$cctor();return g.externalIpAddress;};f.set_externalIpAddress=function(B){g.$cctor();g.externalIpAddress=B;};g.$cctor=function(){g.$cctor=a.ignore;g.externalIpAddress="";};h.Run$16$20=function(B){return function(C){var D;o.StartImmediate((D=null,o.Delay(function(){return o.TryWith(o.Delay(function(){var E;E=C.Vars.Hole("filelocation").$1.Get();return o.Bind((new q.New()).Async("FilesExchanger.Host:FilesExchanger.Host.InternalContext.SendFilesHandler.Send:-1323212191",[f.externalIpAddress(),E]),function(){B.Set("ok");return o.Zero();});}),function(E){if(E instanceof a.Error){B.Set("error");return o.Zero();}else throw E;});})),null);};};h.Run=function(){var B,C,D,E,F,G,H;B=s.Create$1("");return(C=(D=B.get_View(),(E=(F=new w.New$1(),(F.h.push(x.EventQ2(F.k,"onsend",function(){return F.i;},function(I){var J;o.StartImmediate((J=null,o.Delay(function(){return o.TryWith(o.Delay(function(){var K;K=I.Vars.Hole("filelocation").$1.Get();return o.Bind((new q.New()).Async("FilesExchanger.Host:FilesExchanger.Host.InternalContext.SendFilesHandler.Send:-1323212191",[f.externalIpAddress(),K]),function(){B.Set("ok");return o.Zero();});}),function(K){if(K instanceof a.Error){B.Set("error");return o.Zero();}else throw K;});})),null);})),F)),(E.h.push({$:2,$0:"sendfileresponse",$1:D}),E))),(G=x.CompleteHoles(C.k,C.h,[["filelocation",0,null]]),(H=new y.New(G[1],m.sendfileform(G[0])),C.i=H,H))).get_Doc();};i.Run$14$22=function(B){return function(){var C;o.StartImmediate((C=null,o.Delay(function(){B.Set("res");return o.Zero();})),null);};};i.Run=function(){var B,C,D,E,F;B=s.Create$1("");return(C=(D=new w.New$1(),(D.h.push(x.EventQ2(D.k,"download",function(){return D.i;},function(){var G;o.StartImmediate((G=null,o.Delay(function(){B.Set("res");return o.Zero();})),null);})),D)),(E=x.CompleteHoles(C.k,C.h,[]),(F=new y.New(E[1],m.getfileform(E[0])),C.i=F,F))).get_Doc();};j.Run$16$24=function(B){return function(C){var D;o.StartImmediate((D=null,o.Delay(function(){var E;E=C.Vars.Hole("address").$1.Get();return o.TryWith(o.Delay(function(){return o.Bind((new q.New()).Async("FilesExchanger.Host:FilesExchanger.Host.Handlers.GenerateDeviceNameHandler.GetName:-710314813",[]),function(F){return o.Bind((new q.New()).Async("FilesExchanger.Host:FilesExchanger.Host.Handlers.TestConnectHandler.TestConnect:118170792",[E,F]),function(G){f.set_externalIpAddress(G);B.Set("connected");return o.Zero();});});}),function(F){if(F instanceof a.Error){B.Set("disconnected");return o.Zero();}else throw F;});})),null);};};j.Run=function(){var B,C,D,E,F,G,H;B=s.Create$1("");return(C=(D=B.get_View(),(E=(F=new w.New$1(),(F.h.push(x.EventQ2(F.k,"tryconnect",function(){return F.i;},function(I){var J;o.StartImmediate((J=null,o.Delay(function(){var K;K=I.Vars.Hole("address").$1.Get();return o.TryWith(o.Delay(function(){return o.Bind((new q.New()).Async("FilesExchanger.Host:FilesExchanger.Host.Handlers.GenerateDeviceNameHandler.GetName:-710314813",[]),function(L){return o.Bind((new q.New()).Async("FilesExchanger.Host:FilesExchanger.Host.Handlers.TestConnectHandler.TestConnect:118170792",[K,L]),function(M){f.set_externalIpAddress(M);B.Set("connected");return o.Zero();});});}),function(L){if(L instanceof a.Error){B.Set("disconnected");return o.Zero();}else throw L;});})),null);})),F)),(E.h.push({$:2,$0:"connectionreserved",$1:D}),E))),(G=x.CompleteHoles(C.k,C.h,[["address",0,null]]),(H=new y.New(G[1],m.tryconnectform(G[0])),C.i=H,H))).get_Doc();};k.Run$15$32=function(B){return function(){var C;o.StartImmediate((C=null,o.Delay(function(){return o.Bind((new q.New()).Async("FilesExchanger.Host:FilesExchanger.Host.Handlers.GenerateDeviceNameHandler.GetName:-710314813",[]),function(D){B.Set(D);return o.Zero();});})),null);};};k.Run=function(){var B,C,D,E,F,G,H;B=s.Create$1("");return(C=(D=B.get_View(),(E=(F=new w.New$1(),(F.h.push(x.EventQ2(F.k,"generatedevicename",function(){return F.i;},function(){var I;o.StartImmediate((I=null,o.Delay(function(){return o.Bind((new q.New()).Async("FilesExchanger.Host:FilesExchanger.Host.Handlers.GenerateDeviceNameHandler.GetName:-710314813",[]),function(J){B.Set(J);return o.Zero();});})),null);})),F)),(E.h.push({$:2,$0:"devicename",$1:D}),E))),(G=x.CompleteHoles(C.k,C.h,[]),(H=new y.New(G[1],m.generatedevicenameform(G[0])),C.i=H,H))).get_Doc();};l.DeviceNameModule=function(){return k.Run();};l.TestConnectionModule=function(){return j.Run();};l.GetFileModule=function(){return i.Run();};l.SendFileModule=function(){return h.Run();};m.sendfileform=function(B){A.LoadLocalTemplates("main");return B?A.NamedTemplate("main",{$:1,$0:"sendfileform"},B):void 0;};m.getfileform=function(B){A.LoadLocalTemplates("main");return B?A.NamedTemplate("main",{$:1,$0:"getfileform"},B):void 0;};m.tryconnectform=function(B){A.LoadLocalTemplates("main");return B?A.NamedTemplate("main",{$:1,$0:"tryconnectform"},B):void 0;};m.generatedevicenameform=function(B){A.LoadLocalTemplates("main");return B?A.NamedTemplate("main",{$:1,$0:"generatedevicenameform"},B):void 0;};}(self));
